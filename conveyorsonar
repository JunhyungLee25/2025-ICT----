#define ENA 9     // ëª¨í„° ì†ë„ ì œì–´ (PWM í•€)
#define IN1 7     // ëª¨í„° ë°©í–¥ ì œì–´ 1
#define IN2 8     // ëª¨í„° ë°©í–¥ ì œì–´ 2

#define TRIG 10   // ì´ˆìŒíŒŒ ì„¼ì„œ Trig í•€
#define ECHO 11   // ì´ˆìŒíŒŒ ì„¼ì„œ Echo í•€

long duration;
int distance;
unsigned long lastDetectionTime;
const unsigned long timeout = 5000;  // 5ì´ˆ íƒ€ì„ì•„ì›ƒ (ë°€ë¦¬ì´ˆ ë‹¨ìœ„)

void setup() {
    pinMode(ENA, OUTPUT);
    pinMode(IN1, OUTPUT);
    pinMode(IN2, OUTPUT);
    
    pinMode(TRIG, OUTPUT);
    pinMode(ECHO, INPUT);

    Serial.begin(9600);  // ì‹œë¦¬ì–¼ ëª¨ë‹ˆí„° ì¶œë ¥
    lastDetectionTime = millis();  // ì‹œì‘ ì‹œê°„ ì„¤ì •
}

void loop() {
    distance = getDistance(); // ì´ˆìŒíŒŒ ì„¼ì„œë¥¼ í†µí•œ ê±°ë¦¬ ì¸¡ì •
    Serial.print("Distance: ");
    Serial.print(distance);
    Serial.println(" cm");

    if (distance > 0 && distance < 100) { // ì¥ì• ë¬¼ì´ 100cm ì´ë‚´ì— ìˆìœ¼ë©´
        lastDetectionTime = millis(); // ë§ˆì§€ë§‰ ê°ì§€ ì‹œê°„ ì—…ë°ì´íŠ¸
        motorRun(); // ëª¨í„° ê³„ì† êµ¬ë™
    }

    // ë§ˆì§€ë§‰ ê°ì§€ ì´í›„ 5ì´ˆê°€ ì§€ë‚¬ë‹¤ë©´ ëª¨í„° ì •ì§€
    if (millis() - lastDetectionTime > timeout) {
        motorStop();
    }

    delay(100); // ì„¼ì„œ ì—…ë°ì´íŠ¸ ì£¼ê¸°
}

// ğŸš€ **ì´ˆìŒíŒŒ ì„¼ì„œë¥¼ í†µí•´ ê±°ë¦¬ ì¸¡ì •**
int getDistance() {
    digitalWrite(TRIG, LOW);
    delayMicroseconds(2);
    digitalWrite(TRIG, HIGH);
    delayMicroseconds(10);
    digitalWrite(TRIG, LOW);

    duration = pulseIn(ECHO, HIGH);
    return duration * 0.034 / 2;  // cm ë‹¨ìœ„ ê±°ë¦¬ ë°˜í™˜
}

// ğŸ **DC ëª¨í„° êµ¬ë™ (ì•ìœ¼ë¡œ ì´ë™)**
void motorRun() {
    digitalWrite(IN1, HIGH);
    digitalWrite(IN2, LOW);
    analogWrite(ENA, 150);  // ì†ë„ ì¡°ì ˆ (0~255)
}

// ğŸ›‘ **DC ëª¨í„° ì •ì§€**
void motorStop() {
    digitalWrite(IN1, LOW);
    digitalWrite(IN2, LOW);
    analogWrite(ENA, 0);
}
